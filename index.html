<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AWS CLF-C02 — Quiz</title>
  <style>
    :root {
      --bg: #0b0f19;
      --card: #11182a;
      --muted: #8ea1b5;
      --text: #e8eef6;
      --accent: #4ea8ff;
      --ok: #28c76f;
      --bad: #ff5d5d;
      --chip: #1a2440
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, #0b0f19, #0e1324);
      color: var(--text);
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 18px
    }

    .card {
      background: var(--card);
      border: 1px solid #1e2741;
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35)
    }

    h1 {
      color: var(--text);
      font-weight: 800;
      margin: .2rem 0 1rem;
      font-size: 1.6rem
    }

    .sub {
      color: var(--muted);
      font-size: .95rem;
      margin-top: -.3rem;
      line-height: 1.4
    }

    .row-inline {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      gap: 12px;
      margin-top: 16px;
    }

    .field {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }

    .field-label {
      font-size: .8rem;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 4px;
      display: block;
    }

    select {
      appearance: none;
      background: #0f162a;
      border: 1px solid #2a355c;
      border-radius: 10px;
      padding: 10px 12px;
      color: #cfe2ff;
      font-size: .9rem;
      line-height: 1.3;
      cursor: pointer;
      min-width: 120px;
    }

    .load-btn {
      background: var(--accent);
      color: #031227;
      border: 0;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      cursor: pointer;
      font-size: .9rem;
      white-space: nowrap;
    }

    .hint {
      font-size: .8rem;
      color: var(--muted);
      line-height: 1.4;
    }

    .qnum {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: .25rem 0 1rem;
      color: var(--muted)
    }

    .chip {
      background: var(--chip);
      color: #c9d6ea;
      border: 1px solid #2a355c;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: .85rem
    }

    .question {
      color: var(--text);
      font-size: 1.15rem;
      line-height: 1.45;
      min-height: 2.5em
    }

    .options {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 18px 0
    }

    .opt {
      display: flex;
      align-items: stretch;
      border: 1px solid #273059;
      background: #0f162a;
      border-radius: 14px;
      overflow: hidden
    }

    .opt input {
      display: none
    }

    .opt label {
      display: flex;
      gap: 12px;
      align-items: center;
      width: 100%;
      padding: 14px 14px;
      cursor: pointer;
      color: #dfe7f7
    }

    .letter {
      min-width: 34px;
      height: 34px;
      border-radius: 8px;
      display: grid;
      place-items: center;
      background: #1a2440;
      border: 1px solid #2c3a66;
      color: #a9bee0;
      font-weight: 700
    }

    .opt.checked {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(78, 168, 255, .25) inset
    }

    .opt.correct {
      border-color: var(--ok)
    }

    .opt.wrong {
      border-color: var(--bad)
    }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap
    }

    button {
      border: 0;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      cursor: pointer;
      font-size: .9rem
    }

    .primary {
      background: var(--accent);
      color: #031227
    }

    .ghost {
      background: #131b31;
      color: #cfe2ff;
      border: 1px solid #2a355c
    }

    .primary[disabled] {
      opacity: .6;
      cursor: not-allowed
    }

    .feedback {
      min-height: 1.4em;
      margin: 12px 2px 0;
      font-size: .95rem
    }

    .ok {
      color: var(--ok)
    }

    .bad {
      color: var(--bad)
    }

    .progress {
      height: 10px;
      background: #0e1426;
      border: 1px solid #22305b;
      border-radius: 999px;
      overflow: hidden;
      margin: 12px 0 18px
    }

    .bar {
      height: 100%;
      background: linear-gradient(90deg, #4ea8ff, #6ee7ff)
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      color: var(--muted);
      font-size: .92rem;
      flex-wrap: wrap;
      row-gap: 8px
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #2a355c;
      background: #121a30;
      color: #cfe2ff
    }

    .score {
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--text)
    }

    .review {
      margin-top: 16px
    }

    details {
      background: #0f162a;
      border: 1px solid #26335e;
      border-radius: 12px;
      padding: 12px 14px;
      margin: 10px 0
    }

    summary {
      cursor: pointer;
      color: #cfe2ff
    }

    .muted {
      color: #9db2cf
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- PANEL WYBORU BAZY PYTAŃ / KONFIGURACJI STARTU -->
    <div class="card" id="datasetCard">
      <h1>Wybierz zestaw pytań</h1>
      <div class="sub">
        1. Wybierz plik z pytaniami z folderu <b>/datasets</b><br />
        2. Wybierz ile pytań chcesz w tym quizie<br />
        3. Kliknij „Załaduj bazę pytań ▶”<br />
        Po załadowaniu ten panel zniknie, a pojawi się quiz.
      </div>

      <div class="row-inline">
        <div class="field">
          <label for="datasetSelect" class="field-label">Zestaw pytań</label>
          <select id="datasetSelect">
            <!-- opcje dodamy dynamicznie -->
          </select>
        </div>

        <div class="field">
          <label for="questionCountSelect" class="field-label">Ile pytań?</label>
          <select id="questionCountSelect">
            <option value="10">10 pytań</option>
            <option value="20" selected>20 pytań</option>
            <option value="30">30 pytań</option>
            <option value="40">40 pytań</option>
            <option value="50">50 pytań</option>
          </select>
        </div>

        <button id="loadBtn" class="load-btn">Załaduj bazę pytań ▶</button>
      </div>

      <div class="hint" style="margin-top:8px">
        Każdy plik JSON w /datasets powinien mieć strukturę:
        <code>{ question, options {A,B,...}, correct_answers [..] }</code>
      </div>

      <div class="hint" id="loadStatus" style="margin-top:4px"></div>
    </div>

    <!-- KARTA QUIZU (ukryta dopóki nie wystartujemy) -->
    <div class="card" id="quizCard" style="display:none;">
      <h1>AWS CLF-C02 — Quiz</h1>
      <div class="sub">
        Masz losowy zestaw pytań na podstawie wybranego pliku i liczby pytań.<br />
        Restart odświeża quiz w ramach tej samej puli, bez ponownego wyboru pliku.
      </div>

      <div class="progress">
        <div id="bar" class="bar" style="width:0%"></div>
      </div>

      <div class="qnum">
        <span class="chip" id="counter">Pytanie 1 / 20</span>
        <span class="chip" id="multiFlag" style="display:none">Wybierz WIELE</span>
        <span class="chip" id="score">0 poprawnych</span>
      </div>

      <div id="question" class="question"></div>
      <div id="options" class="options"></div>

      <div class="actions">
        <button id="submit" class="primary" disabled>Sprawdź odpowiedź</button>
        <button id="next" class="ghost" style="display:none">Następne ▶</button>
        <button id="restart" class="ghost" style="margin-left:auto">⟲ Restart</button>
      </div>

      <div id="feedback" class="feedback"></div>

      <div class="footer">
        <span class="pill">Tryb: natychmiastowa weryfikacja</span>
        <span class="pill">Zaznacz odpowiedź i kliknij „Sprawdź”</span>
      </div>
    </div>

    <!-- WYNIK -->
    <div id="result" class="card" style="display:none;">
      <div class="score" id="finalScore"></div>
      <div class="sub" id="finalSub"></div>
      <div class="review" id="review"></div>
    </div>
  </div>

  <script>
    // STAN
    let QUESTIONS = []
    let idx = 0
    let correct = 0
    const picks = []

    // DOM refs
    const els = {
      bar: document.getElementById('bar'),
      counter: document.getElementById('counter'),
      multiFlag: document.getElementById('multiFlag'),
      score: document.getElementById('score'),
      q: document.getElementById('question'),
      opts: document.getElementById('options'),
      feedback: document.getElementById('feedback'),
      submit: document.getElementById('submit'),
      next: document.getElementById('next'),
      restart: document.getElementById('restart'),
      result: document.getElementById('result'),
      finalScore: document.getElementById('finalScore'),
      finalSub: document.getElementById('finalSub'),
      review: document.getElementById('review'),
      datasetCard: document.getElementById('datasetCard'),
      quizCard: document.getElementById('quizCard'),
      datasetSelect: document.getElementById('datasetSelect'),
      questionCountSelect: document.getElementById('questionCountSelect'),
      loadBtn: document.getElementById('loadBtn'),
      loadStatus: document.getElementById('loadStatus')
    }

    function shuffle(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1))
        const tmp = a[i]
        a[i] = a[j]
        a[j] = tmp
      }
      return a
    }

    function render() {
      const q = QUESTIONS[idx]

      els.feedback.textContent = ''
      els.submit.disabled = true
      els.next.style.display = 'none'

      els.multiFlag.style.display = q.correct.length > 1 ? 'inline-flex' : 'none'

      els.counter.textContent = `Pytanie ${idx + 1} / ${QUESTIONS.length}`
      els.bar.style.width = Math.round((idx) / QUESTIONS.length * 100) + '%'

      els.q.textContent = q.text

      els.opts.innerHTML = ''
      const currentPick = new Set()

      Object.entries(q.options).forEach(([L, txt]) => {
        const row = document.createElement('div')
        row.className = 'opt'
        const id = `q${idx}_${L}`

        row.innerHTML = `
          <input type="checkbox" id="${id}">
          <label for="${id}">
            <span class="letter">${L}</span>
            <span>${txt}</span>
          </label>
        `

        row.addEventListener('click', () => {
          const chk = row.querySelector('input')

          if (q.correct.length === 1) {
            [...els.opts.querySelectorAll('input')].forEach(i => {
              i.checked = false
              i.parentElement.classList.remove('checked')
            })
          }

          chk.checked = !chk.checked
          row.classList.toggle('checked', chk.checked)

          const picksNow = [...els.opts.querySelectorAll('input')]
            .filter(i => i.checked)
            .map(i => i.id.split('_')[1])

          currentPick.clear()
          picksNow.forEach(x => currentPick.add(x))

          els.submit.disabled = currentPick.size === 0
        })

        els.opts.appendChild(row)
      })

      els.submit.onclick = () => {
        const picked = [...els.opts.querySelectorAll('input')]
          .filter(i => i.checked)
          .map(i => i.id.split('_')[1])

        const need = new Set(q.correct)
        const got = new Set(picked)
        picks[idx] = picked

        const ok = (need.size === got.size) && [...need].every(x => got.has(x))

          ;[...els.opts.children].forEach(row => {
            const L = row.querySelector('.letter').textContent
            if (need.has(L)) row.classList.add('correct')
            if (got.has(L) && !need.has(L)) row.classList.add('wrong')
          })

        els.submit.disabled = true
        els.next.style.display = 'inline-flex'

        if (ok) {
          correct++
          els.feedback.innerHTML = '<span class="ok">✅ Dobrze!</span>'
        } else {
          els.feedback.innerHTML =
            '<span class="bad">❌ Niedokładnie.</span> Prawidłowa odpowiedź: <b>' +
            [...need].join(', ') +
            '</b>'
        }

        els.score.textContent = `${correct} poprawnych`
      }

      els.next.onclick = () => {
        if (idx < QUESTIONS.length - 1) {
          idx++
          render()
        } else {
          finish()
        }
      }
    }

    function finish() {
      const pct = Math.round(correct / QUESTIONS.length * 1000) / 10

      els.bar.style.width = '100%'
      els.counter.textContent = `Koniec — ${QUESTIONS.length} pytań`

      els.q.innerHTML = '<b>To już wszystko!</b>'
      els.opts.innerHTML = ''
      els.submit.disabled = true
      els.next.style.display = 'none'
      els.feedback.textContent = ''

      els.result.style.display = 'block'
      els.finalScore.textContent = `Wynik: ${correct}/${QUESTIONS.length} (${pct}%)`

      const wrong = QUESTIONS
        .map((q, i) => ({ q, i }))
        .filter(({ q, i }) => (q.correct.join(',') !== (picks[i] || []).join(',')))

      const cnt = wrong.length

      els.finalSub.textContent = cnt === 0
        ? 'Perfekcyjnie! Wszystko poprawnie.'
        : `Błędne/niepełne odpowiedzi: ${cnt}`

      if (cnt > 0) {
        const frag = document.createDocumentFragment()

        wrong.forEach(({ q, i }) => {
          const d = document.createElement('details')
          const letters = Object.keys(q.options).sort()
          const pickedAns = (picks[i] || []).join(', ') || '—'

          d.innerHTML = `
            <summary><b>Pytanie ${i + 1}.</b> ${q.text}</summary>
            <div class="muted">
              Twoja odpowiedź: <b>${pickedAns}</b>
              &nbsp;|&nbsp;
              Poprawna: <b>${q.correct.join(', ')}</b>
            </div>
            <ul class="muted">
              ${letters.map(L => `<li><b>${L}.</b> ${q.options[L]}</li>`).join('')}
            </ul>
          `

          frag.appendChild(d)
        })

        els.review.innerHTML = ''
        els.review.appendChild(frag)
      } else {
        els.review.innerHTML = ''
      }
    }

    function resetQuizState() {
      idx = 0
      correct = 0
      picks.length = 0
      els.score.textContent = '0 poprawnych'
      els.result.style.display = 'none'
      els.bar.style.width = '0%'
      els.feedback.textContent = ''
      els.finalScore.textContent = ''
      els.finalSub.textContent = ''
      els.review.innerHTML = ''
      els.q.textContent = ''
      els.opts.innerHTML = ''
    }

    // Restart quizu bez ponownego wyboru pliku/liczby pytań
    els.restart.onclick = () => {
      idx = 0
      correct = 0
      picks.length = 0
      els.score.textContent = '0 poprawnych'
      els.result.style.display = 'none'
      render()
    }

    async function loadQuestionsFromFile(fileName, desiredCount) {
      els.loadStatus.textContent = `Ładowanie ${fileName} ...`

      try {
        const res = await fetch(fileName)
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`)
        }

        const raw = await res.json()

        const allQuestions = raw.map(q => ({
          text: q.question,
          options: q.options,
          correct: q.correct_answers
        }))

        // wybór liczby pytań
        let count = parseInt(desiredCount, 10)
        if (isNaN(count) || count < 1) {
          count = 1
        }

        if (count > allQuestions.length) {
          count = allQuestions.length
          els.loadStatus.textContent =
            `Zażądano więcej pytań niż dostępne, więc używam maksymalnie ${count}.`
        } else {
          els.loadStatus.textContent = ''
        }

        QUESTIONS = shuffle(allQuestions).slice(0, count)

        resetQuizState()
        render()

        els.loadStatus.textContent +=
          (els.loadStatus.textContent ? ' ' : '') +
          `Załadowano ${fileName}. Wylosowano ${QUESTIONS.length} pytań.`

        // chowamy panel wyboru, pokazujemy quiz
        els.datasetCard.style.display = 'none'
        els.quizCard.style.display = 'block'
      } catch (err) {
        els.loadStatus.textContent =
          `Błąd przy ładowaniu ${fileName}: ${err.message}`
        console.error(err)
      }
    }

    // Automatyczne wykrywanie dostępnych plików .json z katalogu /datasets
    async function initDatasets() {
      try {
        const res = await fetch('./datasets.json');
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }

        const datasets = await res.json();
        // datasets = [{file:"datasets/questions-practice1.json", label:"Practice 1"}, ...]

        els.datasetSelect.innerHTML = '';

        if (datasets.length === 0) {
          const opt = document.createElement('option');
          opt.value = '';
          opt.textContent = 'Brak dostępnych zestawów';
          els.datasetSelect.appendChild(opt);

          els.loadStatus.textContent = 'Brak wpisów w datasets.json';
          return;
        }

        datasets.forEach(ds => {
          const opt = document.createElement('option');
          opt.value = ds.file;      // np. "datasets/questions-practice1.json"
          opt.textContent = ds.label || ds.file;
          els.datasetSelect.appendChild(opt);
        });

        els.loadStatus.textContent = `Znaleziono ${datasets.length} zestaw(y) pytań`;
      } catch (err) {
        els.datasetSelect.innerHTML = '';
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = 'Nie można wczytać datasets.json';
        els.datasetSelect.appendChild(opt);

        els.loadStatus.textContent = `Błąd przy pobieraniu datasets.json: ${err.message}`;
        console.error(err);
      }
    }

    // Start quizu po kliknięciu
    els.loadBtn.addEventListener('click', () => {
      const chosenFile = els.datasetSelect.value
      const desiredCount = els.questionCountSelect.value

      if (!chosenFile) {
        els.loadStatus.textContent = 'Nie wybrano pliku z pytaniami'
        return
      }

      loadQuestionsFromFile(chosenFile, desiredCount)
    })

    // init
    initDatasets()
  </script>
</body>

</html>